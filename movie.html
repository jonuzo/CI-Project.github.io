<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="styles.css" type="text/css">
</head>

<body>
  <header>
    <h1 id="headertext">The Casual Reviews</h1>
  </header>

  <nav>
    <ul>
      <a href="about.html" id="about">About Us</a>
    </ul>
    <ul>
      <a href=index.html id="home">Home</a>
    </ul>
    <ul>
      <a href="loginAuth.html" id="register">Accounts</a>
    </ul>
  </nav>

  <h1 id="movietitle"></h1>

  <div id="specific-data"></div>

  <div id="recommendations"></div>

  <script>
    const apiKey = '6aa86f5797de13c2b8d8eb2581248f51';

    function loadSearchData(movieId) {
      if (movieId) {
        fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}&language=en-US`)
          .then(response => response.json())
          .then(data => {
            const moviePosterPath = data.poster_path;
            const movieTitle = data.title;
            const movieReleaseDate = data.release_date;
            const movieOverview = data.overview;

            document.getElementById("movietitle").innerText = movieTitle;

            const specificData = document.getElementById("specific-data");
            specificData.innerHTML = `
              <img src="https://image.tmdb.org/t/p/w500${moviePosterPath}" alt="${movieTitle} Poster" />
              <p></p>
              <p><strong>Release date:</strong> ${movieReleaseDate}</p>
              <p><strong>Overview:</strong> ${movieOverview}</p>
              <p></p>
            `;
          })
          .catch(error => console.log(error));
      }
    }

    function handleRecommendedMovieClick(movieId) {
      loadSearchData(movieId);
    }

    function fetchRecommendedMovies() {
      const searchParams = new URLSearchParams(window.location.search);
      const movieTitle = searchParams.get("movie-title");

      if (movieTitle) {
        fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${movieTitle}`)
          .then(response => response.json())
          .then(data => {
            if (data.results.length > 0) {
              const movieId = data.results[0].id;
              const moviePosterPath = data.results[0].poster_path;
              const movieTitle = data.results[0].title;
              const movieReleaseDate = data.results[0].release_date;
              const movieOverview = data.results[0].overview;

              document.getElementById("movietitle").innerText = movieTitle;

              const specificData = document.getElementById("specific-data");
              specificData.innerHTML = `
                <img src="https://image.tmdb.org/t/p/w500${moviePosterPath}" alt="${movieTitle} Poster" />
                <p></p>
                <p><strong>Release date1:</strong> ${movieReleaseDate}</p>
                <p><strong>Overview:</strong> ${movieOverview}</p>
                <p></p>
              `;

              fetch(`https://api.themoviedb.org/3/movie/${movieId}/recommendations?api_key=${apiKey}&language=en-US&page=1`)
                .then(response => response.json())
                .then(data => {
                  const recommendations = document.getElementById("recommendations");
                  recommendations.innerHTML = `
                    <h2>Recommended Movies:</h2>
                  `;

                  data.results.slice(0, 4).forEach(movie => {
                    const movieTitle = movie.title;
                    const moviePosterPath = movie.poster_path;
                    const movieId = movie.id;

                    const movieElement = `
                      <div class="movie2">
                        <div class="movie2-container">
                          <a href="#" onclick="handleRecommendedMovieClick(${movieId});">
                            <img src="https://image.tmdb.org/t/p/w200${moviePosterPath}" alt="${movieTitle} Poster" />
                          </a>
                          <p>${movieTitle}</p>
                        </div>
                      </div>
                    `;

                    recommendations.insertAdjacentHTML("beforeend", movieElement);
                  });
                })
                .catch(error => console.log(error));
            }
          })
          .catch(error => console.log(error));
      }
    }
  </script>

  <script>
    fetchRecommendedMovies();
  </script>

</body>

</html>
