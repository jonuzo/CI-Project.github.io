<!DOCTYPE html>
<html>

<head>
  <title>Rate a Film</title>

  <link rel="stylesheet" type="text/css" href="stars.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="base.css">
</head>

<body onload="loadSearchData()">
  <nav>
    <li><a href="index.html">Home</a></li>
  </nav>

  <div class="Movies">
    <h1 id="movietitle"></h1>
    <div id="specific-data"></div>
  </div>

  <form id="review_form" onsubmit="submitReview(); return false;"></form>

  <form action="submit-rating.php" method="post" onsubmit="return validateRating();">
  
    <p>
      <label for="reviewer_name">Reviewer Name:</label>
      <input type="text" id="reviewer_name" name="reviewer_name" required>
    </p>

    <p>
      <label for="review">Review:</label>
      <textarea id="review" name="review" rows="5"></textarea>
    </p>

    <p>
      <label for="rate_title">Rate it below:</label>
    </p>

    <div class="rate">
      <input type="radio" id="star5" name="rate" value="5" />
      <label for="star5" title="text">5 stars</label>
      <input type="radio" id="star4" name="rate" value="4" />
      <label for="star4" title="text">4 stars</label>
      <input type="radio" id="star3" name="rate" value="3" />
      <label for="star3" title="text">3 stars</label>
      <input type="radio" id="star2" name="rate" value="2" />
      <label for="star2" title="text">2 stars</label>
      <input type="radio" id="star1" name="rate" value="1" />
      <label for="star1" title="text">1 star</label>
    </div>

    <p>
      <input type="submit" value="Submit">
    </p>
  </form>

  <script>
    function loadSearchData() {
  const searchParams = new URLSearchParams(window.location.search);
  const movieTitle = searchParams.get("movie-title"); 

  if (movieTitle) {
    fetch(`https://api.themoviedb.org/3/search/movie?api_key=6aa86f5797de13c2b8d8eb2581248f51&language=en-US&query=${movieTitle}&page=1&include_adult=false`)
      .then(response => response.json())
      .then(data => {
        const title = data.results[0].title;
        document.getElementById("movietitle").textContent = movieTitle;

        const synopsis = data.results[0].overview;
        const specificData = document.getElementById("specific-data");
        specificData.innerHTML = `
          <p>${synopsis}</p>
          <img src="https://image.tmdb.org/t/p/w500/${data.results[0].poster_path}" alt="${title} poster">
        `;
      })
      .catch(error => console.log(error));
  }
}

  </script>

  <script>

        function submitReview() {
          const movieTitle = localStorage.getItem('movie-title');
          const reviewerName = document.getElementById('reviewer_name').value;
          const reviewText = document.getElementById('review').value;
          const rating = document.querySelector('input[name="rate"]:checked').value;

          // Create an object with the review data
          const reviewData = {
            movieTitle: movieTitle,
            reviewerName: reviewerName,
            reviewText: reviewText,
            rating: rating
          };

          // Store the review data in Local Storage
          const reviews = JSON.parse(localStorage.getItem('movie-reviews')) || {};
          if (!reviews[movieTitle]) {
            reviews[movieTitle] = [];
          }
          reviews[movieTitle].push(reviewData);
          localStorage.setItem('movie-reviews', JSON.stringify(reviews));
        }
    
  </script>

</body>

</html>
