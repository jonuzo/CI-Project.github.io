<!DOCTYPE html>
<html>

<head>
  <title>Rate a Film</title>

  <link rel="stylesheet" type="text/css" href="stars.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="base.css">
  

</head>

<body onload="loadSearchData()">
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
    </ul>
  </nav>

  <div class="Movies">
    <h1 id="movietitle"></h1>
    <div id="specific-data"></div>
  </div>

  <div id="recommendations"></div>

  <form 
    method="POST" 
    action="https://script.google.com/macros/s/AKfycbw4eS4BP64tocIJeeLne9djN4qFM5prfpt54mAvvEjumon3fW9ouYvkLbH4b5sS0kSeXA/exec">
  
    <p>
      <label for="Film">Film:</label>
      <input name="Film" type="text" placeholder="Film" required>
    </p>
  
    <p>
      <label for="Reviewer">Reviewer:</label>
      <input name="Reviewer" type="text" placeholder="Reviewer" required>
    </p>
  
    <p>
      <label for="Comment">Comment:</label>
      <textarea id="Comment" name="Comment" rows="5" cols="40" placeholder="Comment"></textarea>
    </p>
  
    <p>
      <label for="rate_title">Rate it below:</label>
    </p>
  
    <div class="rate">
      <input type="radio" id="star5" name="rate" value="5" />
      <label for="star5" title="text">5 stars</label>
      <input type="radio" id="star4" name="rate" value="4" />
      <label for="star4" title="text">4 stars</label>
      <input type="radio" id="star3" name="rate" value="3" />
      <label for="star3" title="text">3 stars</label>
      <input type="radio" id="star2" name="rate" value="2" />
      <label for="star2" title="text">2 stars</label>
      <input type="radio" id="star1" name="rate" value="1" />
      <label for="star1" title="text">1 star</label>
    </div>
  
    <p>
      <button type="submit">Submit</button>
    </p>  
  </form>
  
  <style>
    #recommendations {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: scroll;
      -webkit-overflow-scrolling: touch;
    }

    .movie {
      margin-right: 20px;
    }

    .movie:last-child {
      margin-right: 0;
    }
  </style>

  <script>
    const apiKey = '6aa86f5797de13c2b8d8eb2581248f51';

    function loadSearchData() {
      const searchParams = new URLSearchParams(window.location.search);
      const movieTitle = searchParams.get("movie-title"); 

      if (movieTitle) {
        fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${movieTitle}`)
          .then(response => response.json())
          .then(data => {
          const firstResult = data.results[0];
          const movieId = firstResult.id;
                  loadMovieData(movieId);
        loadRecommendations(movieId);
      })
      .catch(error => console.error(error));
  } else {
    console.error('No movie title provided');
  }
}

function loadMovieData(movieId) {
  fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}`)
    .then(response => response.json())
    .then(data => {
      const title = data.title;
      const overview = data.overview;
      const posterPath = data.poster_path;
      const releaseDate = data.release_date;
      const genres = data.genres.map(genre => genre.name).join(", ");

      const movieTitleElement = document.getElementById('movietitle');
      movieTitleElement.innerText = title;

      const specificDataElement = document.getElementById('specific-data');
      const specificDataHtml = `
        <img src="https://image.tmdb.org/t/p/w500${posterPath}" alt="${title} poster" class="movie-poster">
        <p><strong>Release date:</strong> ${releaseDate}</p>
        <p><strong>Genres:</strong> ${genres}</p>
        <p><strong>Overview:</strong> ${overview}</p>
      `;
      specificDataElement.innerHTML = specificDataHtml;
    })
    .catch(error => console.error(error));
}

function loadRecommendations(movieId) {
  fetch(`https://api.themoviedb.org/3/movie/${movieId}/recommendations?api_key=${apiKey}&page=1`)
    .then(response => response.json())
    .then(data => {
      const recommendations = data.results.slice(0, 10);
      const recommendationsElement = document.getElementById('recommendations');
      const recommendationsHtml = recommendations.map(movie => {
        const title = movie.title;
        const posterPath = movie.poster_path;
        return `
          <div class="movie">
            <img src="https://image.tmdb.org/t/p/w500${posterPath}" alt="${title} poster" class="movie-poster">
            <p>${title}</p>
          </div>
        `;
      }).join('');
      recommendationsElement.innerHTML = recommendationsHtml;
    })
    .catch(error => console.error(error));
}
 </script>
</body>
</html>
